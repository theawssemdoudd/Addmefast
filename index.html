<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>AddMeFast Clone</title>
</head>
<body>
  <h1>ğŸš€ AddMeFast Clone</h1>

  <!-- Ø§Ù„ØªØ³Ø¬ÙŠÙ„ -->
  <section>
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø§Ø¨</h2>
    <input type="text" id="reg_username" placeholder="Ø§Ù„Ø§Ø³Ù…">
    <input type="email" id="reg_email" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„">
    <input type="password" id="reg_password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button onclick="register()">ØªØ³Ø¬ÙŠÙ„</button>
  </section>

  <!-- ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
  <section>
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <input type="email" id="login_email" placeholder="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„">
    <input type="password" id="login_password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
  </section>

  <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… -->
  <section>
    <h2>ğŸ‘¤ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ</h2>
    <button onclick="getMe()">Ø¹Ø±Ø¶ Ø¨ÙŠØ§Ù†Ø§ØªÙŠ</button>
    <pre id="me"></pre>
  </section>

  <!-- Ø§Ù„Ù…Ù‡Ø§Ù… -->
  <section>
    <h2>ğŸ“ Ø§Ù„Ù…Ù‡Ø§Ù…</h2>
    <button onclick="loadTasks()">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‡Ø§Ù…</button>
    <ul id="tasks"></ul>
  </section>

  <script>
    const API_BASE = "https://addmefast-nkk1povf3-hamidbevs-projects.vercel.app/"; // ØºÙŠØ±Ù‡ Ø¨Ø±Ø§Ø¨Ø· Ù…Ø´Ø±ÙˆØ¹Ùƒ
    let token = null;

    async function register() {
      const username = document.getElementById("reg_username").value;
      const email = document.getElementById("reg_email").value;
      const password = document.getElementById("reg_password").value;

      const res = await fetch(`${API_BASE}/auth/register`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ username, email, password })
      });
      const data = await res.json();
      if (data.token) {
        token = data.token;
        alert("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­ âœ…");
      } else {
        alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ âŒ");
      }
    }

    async function login() {
      const email = document.getElementById("login_email").value;
      const password = document.getElementById("login_password").value;

      const res = await fetch(`${API_BASE}/auth/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email, password })
      });
      const data = await res.json();
      if (data.token) {
        token = data.token;
        alert("ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âœ…");
      } else {
        alert("Ø®Ø·Ø£ ÙÙŠ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ âŒ");
      }
    }

    async function getMe() {
      const res = await fetch(`${API_BASE}/me`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      const data = await res.json();
      document.getElementById("me").textContent = JSON.stringify(data, null, 2);
    }

    async function loadTasks() {
      const res = await fetch(`${API_BASE}/tasks`);
      const tasks = await res.json();
      const ul = document.getElementById("tasks");
      ul.innerHTML = "";
      tasks.forEach(task => {
        const li = document.createElement("li");
        li.textContent = `${task.title} (+${task.pointsReward} Ù†Ù‚Ø·Ø©) `;
        const btn = document.createElement("button");
        btn.textContent = "Ø¥ÙƒÙ…Ø§Ù„";
        btn.onclick = () => completeTask(task._id);
        li.appendChild(btn);
        ul.appendChild(li);
      });
    }

    async function completeTask(taskId) {
      const res = await fetch(`${API_BASE}/complete`, {
        method: "POST",
        headers: { 
          "Content-Type": "application/json",
          Authorization: `Bearer ${token}`
        },
        body: JSON.stringify({ taskId })
      });
      const data = await res.json();
      alert("âœ… Ù†Ù‚Ø§Ø·Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠØ©: " + data.points);
    }
  </script>
</body>
</html>
